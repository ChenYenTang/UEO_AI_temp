# UI Tabs 模組說明

本資料夾 (`ui_tabs`) 包含了構成「通用性能源操作優化框架」Gradio 使用者介面的所有核心模組。設計上遵循「高內聚、低耦合」的原則，將每個主要功能分頁（Tab）拆分成獨立的 Python 檔案，使得程式碼更易於維護、除錯與擴充。

`main.py` 主程式會從此處匯入各個模組，並在 Gradio 的 `Blocks` 環境中依序呼叫它們的建立函式，最終組合成完整的應用程式介面。

## 模組檔案說明

以下是本資料夾中各個檔案的職責介紹：

### UI 分頁模組

- **`tab_upload.py`**:
  - **功能**: 建立「上傳資料」分頁。
  - **職責**: 提供檔案上傳介面，讓使用者可以上傳訓練 (`train`) 與驗證 (`validation`) 的 CSV 資料集，並在介面上顯示資料的預覽。

- **`tab_select_cols.py`**:
  - **功能**: 建立「選擇欄位」分頁。
  - **職責**: 當使用者上傳資料後，此分頁會動態讀取資料的欄位，並提供下拉選單與複選框，讓使用者能定義哪些欄位分別代表「時間戳記」、「動作 (Action)」以及「獎勵 (Reward)」。

- **`tab_dataclean.py`**:
  - **功能**: 建立「資料清洗」分頁。
  - **職責**: 提供資料預處理的相關選項，包含缺失值填補策略、資料正規化方法（如 Min-Max Scaling）以及設定時序模型的序列長度。處理完成後，會將資料轉換成模型可用的格式。

- **`tab_hyperparam.py`**:
  - **功能**: 建立「超參數設定」分頁。
  - **職責**: 此分頁用於訓練「環境模型」（監督式學習）。使用者可以選擇模型架構（如 LSTM, GRU）、設定學習率、損失函數等超參數，並點擊按鈕開始訓練。訓練過程中的 Loss、R-squared 等指標會以圖表即時呈現。

- **`tab_solver.py`**:
  - **功能**: 建立「求解器」分頁。
  - **職責**: 此分頁用於訓練「求解器模型」（強化學習）。使用者需先選擇一個已訓練好的「環境模型」，接著設定 SAC (Soft Actor-Critic) 演算法的相關超參數，然後開始訓練。此過程旨在找出在模擬環境中的最佳操作策略。

- **`tab_inference.py`**:
  - **功能**: 建立「執行推論」分頁。
  - **職責**: 這是框架的最後一步。使用者可以上傳一份新的資料集，並選擇一個已訓練好的「求解器模型 (Actor)」，系統將會根據輸入的狀態，生成對應的最佳化操作建議，並以表格和圖表呈現。

### 核心邏輯與共享模組

- **`models.py`**:
  - **功能**: 定義所有神經網路模型架構與訓練邏輯。
  - **職責**:
    - 定義監督式學習模型，如 `LSTM_Model`, `GRU_Model` 等，用於建立環境模型。
    - 定義強化學習模型，如 `SoftActorCritic`, `LSTMActor`, `LSTMCritic` 等。
    - 包含模型訓練的主循環函式，如 `train_model` (用於監督式學習) 和 `train_sac_agent` (用於強化學習)。
    - 包含推論相關函式，如 `sac_get_action`。

- **`Preprocessing.py`**:
  - **功能**: 封裝所有資料預處理的函式。
  - **職責**: 提供資料清洗、離群值移除 (IQR)、缺失值填補、特徵縮放以及將資料轉換為時序序列格式 (`preprocess_for_lstm`) 等核心功能。UI 模組會直接呼叫此檔案中的函式來處理資料。

- **`tab_shared.py`**:
  - **功能**: 存放跨 UI 模組共享的常數與輔助函式。
  - **職責**: 避免程式碼重複。例如，模型儲存路徑 (`MODEL_DIR`)、序列長度 (`SEQUENCE_LENGTH`) 等常數，以及繪製圖表 (`create_matplotlib_figure`)、獲取模型檔案列表 (`get_model_files`) 等通用函式都定義於此。

## 協作方式

整個 UI 的運作流程如下：

1.  `main.py` 啟動 `gr.Blocks()`。
2.  `main.py` 依序呼叫 `tab_upload.create_upload_tab()`, `tab_select_cols.create_select_cols_tab()` 等函式，將每個分頁的 UI 元件加入到 Gradio 的佈局中。
3.  各個 `tab_*.py` 檔案內部定義了該分頁的 UI 元件以及與之綁定的事件處理函式 (Callbacks)。
4.  事件處理函式會呼叫 `Preprocessing.py` 和 `models.py` 中的核心邏輯來執行資料處理、模型訓練或推論。
5.  `tab_shared.py` 則為所有模組提供統一的常數設定和共用工具。

透過這種方式，每個檔案的職責都非常明確，大大提升了專案的模組化程度。